{% extends 'base.html' %}

{% block title %}Staff Dashboard - e-Library{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">
        <i class="fas fa-briefcase"></i> Staff Dashboard
    </h1>

    <!-- Key Metrics -->
    <div class="row mb-4">
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h3>{{ active_loans }}</h3>
                    <p class="text-muted mb-0">Active Loans</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-danger">{{ overdue_loans }}</h3>
                    <p class="text-muted mb-0">Overdue</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h3>{{ holds_waiting }}</h3>
                    <p class="text-muted mb-0">Holds Waiting</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h3 class="text-success">{{ holds_ready }}</h3>
                    <p class="text-muted mb-0">Holds Ready</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h3>{{ items_in_transit }}</h3>
                    <p class="text-muted mb-0">In Transit</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h3>{{ pending_requests }}</h3>
                    <p class="text-muted mb-0">Pending Requests</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Primary Actions -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-tasks"></i> Primary Operations</h5>
                </div>
                <div class="card-body">
                    <div class="btn-group" role="group" aria-label="Primary operations">
                        <a href="{% url 'circulation:checkout' %}" class="btn btn-primary">
                            <i class="fas fa-check"></i> Check Out
                        </a>
                        <a href="{% url 'circulation:checkin' %}" class="btn btn-success">
                            <i class="fas fa-undo"></i> Check In
                        </a>
                        <a href="{% url 'circulation:borrower_list' %}" class="btn btn-info">
                            <i class="fas fa-users"></i> Borrowers
                        </a>
                        <a href="{% url 'circulation:manage_holds' %}" class="btn btn-warning">
                            <i class="fas fa-bookmark"></i> Manage Holds
                        </a>
                        <a href="{% url 'circulation:manage_checkout_requests' %}" class="btn btn-secondary">
                            <i class="fas fa-inbox"></i> Checkout Requests
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity & Reports -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Staff Resources</h5>
                </div>
                <div class="card-body">
                    <div class="btn-group-vertical btn-block">
                        <a href="{% url 'circulation:reports' %}" class="btn btn-outline-secondary text-left">
                            <i class="fas fa-file-alt"></i> View Reports
                        </a>
                        <a href="{% url 'circulation:overdue_report' %}" class="btn btn-outline-danger text-left">
                            <i class="fas fa-exclamation-triangle"></i> Overdue Report
                        </a>
                        <a href="{% url 'circulation:circulation_stats' %}" class="btn btn-outline-info text-left">
                            <i class="fas fa-chart-bar"></i> Circulation Stats
                        </a>
                        <a href="{% url 'circulation:transit_list' %}" class="btn btn-outline-warning text-left">
                            <i class="fas fa-shipping-fast"></i> Transit Items
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="fas fa-box"></i> Item Management</h5>
                </div>
                <div class="card-body">
                    <div class="btn-group-vertical btn-block">
                        <a href="{% url 'circulation:send_in_transit' %}" class="btn btn-outline-primary text-left">
                            <i class="fas fa-arrow-right"></i> Send Item in Transit
                        </a>
                        <a href="{% url 'circulation:receive_in_transit' %}" class="btn btn-outline-success text-left">
                            <i class="fas fa-arrow-left"></i> Receive In Transit
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Recent Checkouts</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm table-striped mb-0">
                        <thead class="thead-light">
                            <tr>
                                <th>Item</th>
                                <th>Borrower</th>
                                <th>Due Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for loan in recent_checkouts %}
                            <tr>
                                <td>{{ loan.item.publication.title|truncatewords:5 }}</td>
                                <td>{{ loan.borrower.get_full_name }}</td>
                                <td>{{ loan.due_date|date:"M d" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-muted">No recent checkouts</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Recent Returns</h5>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm table-striped mb-0">
                        <thead class="thead-light">
                            <tr>
                                <th>Item</th>
                                <th>Borrower</th>
                                <th>Returned</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for loan in recent_returns %}
                            <tr>
                                <td>{{ loan.item.publication.title|truncatewords:5 }}</td>
                                <td>{{ loan.borrower.get_full_name }}</td>
                                <td>{{ loan.return_date|date:"M d H:i" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-muted">No recent returns</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <div class="alert alert-info" role="alert">
                <i class="fas fa-info-circle"></i> <strong>Staff Panel:</strong>
                You can perform circulation operations, manage borrowers, and view reports. 
                For system configuration, contact an administrator.
            </div>
        </div>
    </div>
</div>
{% endblock %}
